IntelliJ Core, UAST and Kotlin
------------------------------

Originally, we just downloaded snapshots of intellij-core itself from
https://www.jetbrains.com/intellij-repository/releases, like this:
https://www.jetbrains.com/intellij-repository/releases/com/jetbrains/intellij/idea/intellij-core/171.4249.32/intellij-core-171.4249.32.zip

The version number here, 171.3780.107, matches the IDE used in Studio,
defined in tools/adt/idea/adt-branding/src/idea/AndroidStudioApplicationInfo.xml;
  <build number="__BUILD_NUMBER__" date="__BUILD_DATE__" apiVersion="AI-171.3780.107"/>

However, when we added Kotlin support, it turns out that the Kotlin
compiler itself includes large portions of intellij-core (though thanks
to shrinking it was sometimes only partial classes). Since we need
the Kotlin compiler, we just turn off shrinking in the compiler build
and then drop in the compiler jar (which contains all of intellij-core).


Updating
--------

First, check out a copy of the Kotlin git repository:
$ git checkout https://github.com/JetBrains/kotlin
(or to start a new branch, git checkout -t origin/master -b my-master)

Then switch to a compatible patch branch.

Currently:
$ git checkout 1.2.50
(right now that branch tracks the right IDEA branch that we want, 181,
but in the future you may have to run the bunch tool;
https://github.com/JetBrains/bunches/blob/master/ReadMe.md
$ bunch switch . 182

Then make sure to apply some extra patches to work around bugs
and to add some special methods used by lint:
$ git apply /path/to/kotlin-compiler-patch.diff (which is located in
this directory).

Also currently, revert this CL:
d6405c8147ff26b4c1e3475cc2242f8dea4e669b

Also currently, cherry-pick in this CL:
5c8e4958dbd7982d95610ad8442ddd90a869bd05

Next, build the Kotlin repository:
$ ./gradlew dist
$ cd plugins/uast-kotlin && gradle jar

Finally, back in this prebuilt directory, run the update.xml script,
pointing back to the Kotlin repository:
ant -f update.xml -Dkotlin_src_dir=$MY_KOTLIN_REPO_ROOT

The packaging script will extract code and update the intellij-core and uast prebuilts
in this directory. It performs a number of steps to do that, such as unbundling the
trove classes, replacing a platform icons class, etc.
